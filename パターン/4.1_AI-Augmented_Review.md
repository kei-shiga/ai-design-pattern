# 4.1 AI-Augmented Review (AIによる多層レビュー)

## 概要
AIが生成した大量のコードを人間だけでレビューするとボトルネックになります。人間がレビューする前に、**別のAI（あるいは異なるLLMモデル）に一次レビューをさせる**ことで、単純なミスを事前に排除し、人間は「設計の妥当性」や「ビジネスロジック」の確認に集中できる体制を作ります。

## 詳細・実施手順

1. **一次レビュー (Automated/AI Review):**
   * PR作成時やコミット時に、AIエージェント（GitHub Actions上のスクリプトや専用SaaS）がコードをスキャンします。
   * 構文エラー、明らかなバグ、セキュリティ脆弱性、命名規則違反、タイポなどを指摘させます。
   * 指摘事項があれば、開発者（またはコード生成AI）が修正してから人間にパスします。

2. **二次レビュー (Human Review):**
   * AIの一次チェックを通過したコードのみを人間がレビューします。
   * 人間は「仕様を満たしているか」「システム全体の整合性は取れているか」「ユーザー体験は適切か」といった高度な判断に注力します。

## ワークフロー構成例

**GitHub Actions Workflow + AI Review Tool (Concept)**

1. DeveloperがPRを作成。
2. GitHub Actionsがトリガーされ、`openai-code-review-action` (仮) が走る。
3. AIがDiffを解析し、以下のようなコメントを自動投稿。
   * 「この変数 `tmp` は意味が不明瞭です。`user_count` など具体的にしてください。」
   * 「ここで `files` のNullチェックが抜けています。」
4. Developerが修正してPush。
5. 指摘が解消されたら、人間のReviewerに通知。

## 自動レビュー用プロンプトの構成案

CIツール等でAIにレビューさせる際に使用するプロンプトのイメージです。

```markdown
# Role
あなたはシニアコードレビュアーです。

# Task
以下のGit Diffに対してコードレビューを行ってください。
些細なスタイルの指摘は控え、以下の「重要な問題」に焦点を当ててください。

# Checklist
1. **バグの可能性:** 論理的な誤り、無限ループ、リソースリークの恐れはないか。
2. **セキュリティ:** SQLインジェクション、XSS、機密情報のハードコーディングはないか。
3. **エラーハンドリング:** 例外が発生しうる箇所で適切なtry-catchが行われているか。
4. **パフォーマンス:** 明らかに非効率なアルゴリズム（O(n^2)など）が含まれていないか。

# Output Format
指摘がある場合のみ、以下の形式で出力してください。
- ファイル名: [行番号]
- 重大度: [High/Medium/Low]
- 指摘内容: ...
- 修正案: ...
```

## ツール・サービスの活用
自前でスクリプトを組む以外に、以下のようなサービスも活用できます。
- **CodeRabbit:** AIがPRを自動レビューし、要約と改善提案を行うサービス。
- **GitHub Copilot Code Review:** GitHub上でAIがセキュリティ脆弱性などを指摘。

## メリット
- **レビュー時間の短縮:** 単純なミスを人間が見る必要がなくなります。
- **心理的負担の軽減:** 人間に「インデントがずれている」「変数名がおかしい」と指摘されるより、AIに指摘される方がストレスが少ない場合があります。
- **品質基準の統一:** レビュアーのスキルや疲労度に依存せず、一定の基準でチェックが行われます。
