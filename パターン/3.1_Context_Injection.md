# 3.1 Context Injection / Repository-Aware Prompting

## 概要
AIはプロジェクト固有の「暗黙の了解（規約、構成、使用ライブラリ）」を知りません。
`README.md` や `.cursorrules` などの設定ファイルに、プロジェクトの技術スタック、アーキテクチャ方針、禁止事項を明文化し、AIに常時参照させることで、プロジェクトの一貫性を保ちます。

## 詳細・実施手順

1. **Tech Stack & Rules の明文化:**
   * 使用している言語バージョン、フレームワーク、ライブラリ、ディレクトリ構造をドキュメント化します。
   * 「やってはいけないこと（例：`var`ではなく`const/let`を使う、直接SQLを書かない）」も明記します。

2. **ルールファイルの配置:**
   * **Cursor:** プロジェクトルートに `.cursorrules` ファイルを作成し、AIへの指示を記述します。
   * **GitHub Copilot / ChatGPT:** プロンプトの冒頭に貼り付けるための「コンテキスト定義ファイル（例: `CONTEXT.md`）」を用意するか、リポジトリの `README.md` を充実させます。

3. **リポジトリ構造の共有:**
   * `tree` コマンドの結果や、主要なファイルパスの一覧をプロンプトに含め、AIに全体の地図を理解させます（Repomix等のツールも有効）。

## 設定ファイル例 (.cursorrules)

Cursorエディタを使用する場合の `.cursorrules` の例です。
これを配置しておくと、AIはこの指示に従ってコード生成やチャット応答を行います。

```markdown
# Project Context
- Language: TypeScript 5.0+
- Framework: Next.js 14 (App Router)
- Styling: Tailwind CSS
- State Management: Zustand

# Coding Guidelines
- すべてのコンポーネントはFunctional Componentとして定義すること。
- `any` 型の使用は禁止。適切な型定義を行うか、Genericsを使用すること。
- ファイル名はケバブケース (e.g., `user-profile.tsx`) を使用すること。
- 非同期処理には `async/await` を使用し、`.then()` チェーンは避けること。

# Testing
- テストフレームワークは Jest + React Testing Library を使用。
- ロジックを含むコンポーネントには必ずテストを作成すること。

# Architecture
- Features ディレクトリごとのコロケーション構成を採用しています。
   - `src/features/auth/components/`
   - `src/features/auth/hooks/`
```

## プロンプトへの注入例 (ChatGPT等)

エディタ統合機能がない場合、以下のようなテキストを会話の最初に送信します。

```markdown
以下のプロジェクトコンテキストを前提に回答してください。

[技術スタック]
Python 3.11, Django 4.2, PostgreSQL

[ディレクトリ構造]
/src
  /apps
    /users
    /products
  /core (共通基盤)

[制約]
- ビジネスロジックは `views.py` ではなく `services.py` に記述する
- ORMのN+1問題を避けるため、`select_related`, `prefetch_related` を意識する
```

## メリット
- **一貫性の向上:** 誰がAIを使っても、同じ規約に従ったコードが生成されやすくなります。
- **補正の手間削減:** AIが最初からプロジェクトの文脈を理解しているため、「そうじゃない、うちはこういう書き方なんだ」という修正ラリーが減ります。
- **オンボーディング支援:** 新しい開発者にとっても、ドキュメント化されたルールは有用です。
