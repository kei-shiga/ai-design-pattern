# 3.1 Context Injection / Repository-Aware Prompting

## 概要
AIはプロジェクト固有の「暗黙の了解（規約、構成、使用ライブラリ）」を知りません。
`README.md` や `.cursorrules` などの設定ファイルに、プロジェクトの技術スタック、アーキテクチャ方針、禁止事項を明文化し、AIに常時参照させることで、プロジェクトの一貫性を保ちます。

## 詳細・実施手順

## 詳細・実施手順

1. **Tech Stack & Rules の明文化:**
   * 使用している言語バージョン、フレームワーク、ライブラリ、ディレクトリ構造をドキュメント化します。
   * 「やってはいけないこと（例：同期メソッドの使用禁止、Service Locatorパターンの禁止等）」も明記します。

2. **ルールファイルの配置:**
   * **Cursor:** プロジェクトディレクトリ配下の `.cursor/rules/` にルールファイル（例: `rule.mdc`）を作成し、AIへの指示を記述します。
   * **GitHub Copilot / Visual Studio:** プロンプトの冒頭に貼り付けるための「コンテキスト定義ファイル（例: `CONTEXT.md`）」を用意するか、リポジトリの `README.md` を充実させます。

3. **リポジトリ構造の共有:**
   * `tree` コマンドの結果や、主要なファイルパスの一覧をプロンプトに含め、AIに全体の地図を理解させます。

## 設定ファイル例 (.cursor/rules/rule.mdc)

Cursorエディタを使用する場合の `.cursor/rules/rule.mdc` の例です。
これを配置しておくと、AIはこの指示に従ってコード生成やチャット応答を行います。

```markdown
# Project Context
- Language: C# 12.0 (.NET 8.0)
- Framework: ASP.NET Core Web API
- ORM: Entity Framework Core
- Testing: xUnit + Moq

# Coding Guidelines
- 原則として `async/await` を使用し、非同期メソッド名には `Async` サフィックスを付与すること。
- ローカル変数の型推論には `var` を使用すること（型が明白な場合）。
- Null許容参照型（Nullable Reference Types）を有効にし、警告を無視しないこと。
- コントローラーにはビジネスロジックを書かず、Service層に委譲すること。

# Architecture
- Clean Architecture (Onion Architecture) を採用しています。
   - `src/Core/`: ドメインエンティティとインターフェース
   - `src/Infrastructure/`: DBコンテキスト、リポジトリ実装
   - `src/Web/`: APIコントローラー
```

## プロンプトへの注入例 (Visual Studio Copilot Chat等)

エディタの自動コンテキスト機能が効かない場合や、特定の文脈を強調したい場合、以下のようなテキストを会話の最初に送信します。

```markdown
以下のプロジェクトコンテキストを前提に回答してください。

[技術スタック]
.NET 8, C#, Entity Framework Core, SQL Server

[ディレクトリ構造]
/MySolution.sln
/src
  /MyProject.Core (Domain, Interfaces)
  /MyProject.Infrastructure (Data Access)
  /MyProject.API (Controllers)

[制約]
- データベースアクセスは必ず Repository パターンを経由する
- N+1問題を避けるため、Include利用時は注意する
- DTO (Data Transfer Object) と Entity の変換には AutoMapper ではなく手動マッピングを使用する
```

## メリット
- **一貫性の向上:** 誰がAIを使っても、同じ規約に従ったコードが生成されやすくなります。
- **補正の手間削減:** AIが最初からプロジェクトの文脈を理解しているため、「そうじゃない、うちはこういう書き方なんだ」という修正ラリーが減ります。
- **オンボーディング支援:** 新しい開発者にとっても、ドキュメント化されたルールは有用です。
