# 6.2 Self-Healing Workflows (自己修復ワークフロー)

## 概要
CI/CDパイプラインや本番稼働環境において、エラーが発生した際に**AIが自動的に介入して修正（Heal）を試みる**自律型ワークフローパターンです。
「エラーログの解析」→「修正案の生成」→「パッチ適用」→「再実行」のサイクルを自動化し、人間の運用負荷を下げます。

## 詳細・実施手順

1. **Monitor (監視):**
   * GitHub Actionsの失敗、Sentryのエラー通知、KubernetesのPodクラッシュなどをトリガーにします。

2. **Analyze (解析):**
   * 失敗したジョブのログ（Traceback）を取得します。
   * 関連するソースコードを特定します（Git blame等で変更直後のコミットを探す）。

3. **Remediate (修正):**
   * AIに「エラーログ」と「該当コード」を渡し、修正パッチ（Diff）を生成させます。
   * パッチを適用し、新しいコミットを作成（またはPull Requestを作成）します。

4. **Verify (検証):**
   * 再度パイプラインを実行し、修正されたか確認します。
   * 修正されない、または新たなエラーが出た場合、人間に通知してエスカレーションします。

## 適用しやすいシナリオ

* **依存関係の競合解消:** `npm audit fix` で直らないようなパッケージバージョンの不整合修正。
* **Lint/Formatエラー:** PrettierやESLintのルール違反の自動修正。
* **型定義エラー:** TypeScriptの型不整合の修正。
* **単純なテスト落ち:** タイムアウト値の調整や、モックデータの修正。

## ワークフロー例 (GitHub Actions)

概念的なActionsワークフロー（YAML）です。

```yaml
name: Self-Healing CI

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run Tests
        id: run-tests
        run: npm test
        continue-on-error: true # エラーでも止まらない

      - name: Heal if Failed
        if: steps.run-tests.outcome == 'failure'
        uses: my-org/ai-healer-action@v1
        with:
          api-key: ${{ secrets.OPENAI_API_KEY }}
          error-log: ${{ steps.run-tests.outputs.log }}
```

## メリット
- **MTTR (平均修復時間) の短縮:** 人間が気づく前に修正が完了している可能性があります。
- **Nightly Buildの安定化:** 深夜のビルドエラーで翌朝の開発が止まるのを防げます。
- **運用コスト削減:** 「些細なエラー」に人間が時間を使わなくて済みます。
